import './easybar.css';
import L from 'leaflet';

export default L.Control.EasyBar = L.Control.extend({

    options: {
      position:       'topleft',  // part of leaflet's defaults
      id:             null,       // an id to tag the Bar with
      leafletClasses: true        // use leaflet classes?
    },
  
    initialize: function(buttons, options){
  
      if(options){
        L.Util.setOptions( this, options );
      }
  
      this._buildContainer();
      this._buttons = [];
  
      for(var i = 0; i < buttons.length; i++){
        buttons[i]._bar = this;
        buttons[i]._container = buttons[i].button;
        this._buttons.push(buttons[i]);
        this.container.appendChild(buttons[i].button);
      }
  
    },
  
  
    _buildContainer: function(){
      this._container = this.container = L.DomUtil.create('div', '');
      this.options.leafletClasses && L.DomUtil.addClass(this.container, 'leaflet-bar easy-button-container leaflet-control');
      this.options.id && (this.container.id = this.options.id);
    },
  
  
    enable: function(){
      L.DomUtil.addClass(this.container, 'enabled');
      L.DomUtil.removeClass(this.container, 'disabled');
      this.container.setAttribute('aria-hidden', 'false');
      return this;
    },
  
  
    disable: function(){
      L.DomUtil.addClass(this.container, 'disabled');
      L.DomUtil.removeClass(this.container, 'enabled');
      this.container.setAttribute('aria-hidden', 'true');
      return this;
    },
  
  
    onAdd: function () {
      return this.container;
    },
  
    addTo: function (map) {
      this._map = map;
  
      for(var i = 0; i < this._buttons.length; i++){
        this._buttons[i]._map = map;
      }
  
      var container = this._container = this.onAdd(map),
          pos = this.getPosition(),
          corner = map._controlCorners[pos];
  
      L.DomUtil.addClass(container, 'leaflet-control');
  
      if (pos.indexOf('bottom') !== -1) {
        corner.insertBefore(container, corner.firstChild);
      } else {
        corner.appendChild(container);
      }
  
      return this;
    }
  
  });
  
  L.easyBar = function(){
    var args = [L.Control.EasyBar];
    for(var i = 0; i < arguments.length; i++){
      args.push( arguments[i] );
    }
    return new (Function.prototype.bind.apply(L.Control.EasyBar, args))();
  };
  